<html>
    <head>
        <title>Logged Values Charts</title>
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation"></script>
        <style>
            body {
                font-family: Arial, sans-serif;
                text-align: center;
            }
            .chart-container {
                display: grid;
                grid-template-columns: repeat(2, 1fr);
                gap: 20px;
                width: 100%;
                max-width: 1200px;
                margin: 0 auto;
            }
            canvas {
                width: 100% !important;
                height: 250px !important;
            }
            h1 {
                font-size: 24px;
                margin-bottom: 20px;
            }
            h2 {
                font-size: 20px;
                margin-bottom: 10px;
            }
        </style>
    </head>
    <body>
        <h1>Logged Values in Last 24 Hours</h1>

        <div class="chart-container">
            <div>
                <h2>PM02</h2>
                <canvas id="pm02Chart"></canvas>
            </div>
            <div>
                <h2>RCO2</h2>
                <canvas id="rco2Chart"></canvas>
            </div>
            <div>
                <h2>ATMP</h2>
                <canvas id="atmpChart"></canvas>
            </div>
            <div>
                <h2>RHUM</h2>
                <canvas id="rhumChart"></canvas>
            </div>
        </div>

        <script>
            fetch('/data')
            .then(response => response.json())
            .then(data => {
                function getLineColor(value) {
                    return value > 100 ? 'rgb(255, 99, 132)' : 'rgb(75, 192, 192)';
                }

                const pm02Ctx = document.getElementById('pm02Chart').getContext('2d');
                const rco2Ctx = document.getElementById('rco2Chart').getContext('2d');
                const atmpCtx = document.getElementById('atmpChart').getContext('2d');
                const rhumCtx = document.getElementById('rhumChart').getContext('2d');

                function createChart(ctx, data, label, annotations) {
                    new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: data.timestamps,
                            datasets: [{
                                label: label,
                                data: data[label.toLowerCase()],
                                borderColor: 'rgb(75, 192, 192)',
                                fill: false,
                            }]
                        },
                        options: {
                            responsive: true,
                            scales: {
                                x: {
                                    ticks: {
                                        maxRotation: 90,
                                        minRotation: 45
                                    }
                                }
                            },
                            plugins: {
                                annotation: {
                                    annotations: annotations
                                }
                            }
                        }
                    });
                }

                // Annotations for PM02
                const pm02Annotations = [
                    {
                        type: 'box',
                        yMin: 0,
                        yMax: 25,
                        backgroundColor: 'rgba(0, 255, 0, 0.2)',
                        borderColor: 'green',
                        borderWidth: 1,
                        label: {
                            content: 'Good (0-25)',
                            enabled: true,
                            position: 'center'
                        }
                    },
                    {
                        type: 'box',
                        yMin: 25,
                        yMax: 50,
                        backgroundColor: 'rgba(255, 255, 0, 0.2)',
                        borderColor: 'yellow',
                        borderWidth: 1,
                        label: {
                            content: 'Fair (25-50)',
                            enabled: true,
                            position: 'center'
                        }
                    },
                    {
                        type: 'box',
                        yMin: 50,
                        yMax: 100,
                        backgroundColor: 'rgba(255, 165, 0, 0.2)',
                        borderColor: 'orange',
                        borderWidth: 1,
                        label: {
                            content: 'Poor (50-100)',
                            enabled: true,
                            position: 'center'
                        }
                    },
                    {
                        type: 'box',
                        yMin: 100,
                        yMax: Math.max(...data.pm02),
                        backgroundColor: 'rgba(255, 0, 0, 0.2)',
                        borderColor: 'red',
                        borderWidth: 1,
                        label: {
                            content: 'Bad (>100)',
                            enabled: true,
                            position: 'center'
                        }
                    }
                ];

                // Annotations for RCO2
                const rco2Annotations = [
                    {
                        type: 'box',
                        yMin: 200,
                        yMax: 1000,
                        backgroundColor: 'rgba(0, 255, 0, 0.2)',
                        borderColor: 'green',
                        borderWidth: 1,
                        label: {
                            content: 'Good (200-1000)',
                            enabled: true,
                            position: 'center'
                        }
                    },
                    {
                        type: 'box',
                        yMin: 1000,
                        yMax: 2000,
                        backgroundColor: 'rgba(255, 255, 0, 0.2)',
                        borderColor: 'yellow',
                        borderWidth: 1,
                        label: {
                            content: 'Suboptimal (1000-2000)',
                            enabled: true,
                            position: 'center'
                        }
                    },
                    {
                        type: 'box',
                        yMin: 2000,
                        yMax: Math.max(...data.rco2),
                        backgroundColor: 'rgba(255, 0, 0, 0.2)',
                        borderColor: 'red',
                        borderWidth: 1,
                        label: {
                            content: 'Bad (>2000)',
                            enabled: true,
                            position: 'center'
                        }
                    }
                ];

                // Annotations for RHUM
                const rhumAnnotations = [
                    {
                        type: 'box',
                        yMin: 30,
                        yMax: 60,
                        backgroundColor: 'rgba(0, 255, 0, 0.2)',
                        borderColor: 'green',
                        borderWidth: 1,
                        label: {
                            content: 'Good (30-60)',
                            enabled: true,
                            position: 'center'
                        }
                    }
                ];

                // Create charts
                createChart(pm02Ctx, data, 'PM02', pm02Annotations);
                createChart(rco2Ctx, data, 'RCO2', rco2Annotations);
                createChart(atmpCtx, data, 'ATMP', []); // No annotations for ATMP
                createChart(rhumCtx, data, 'RHUM', rhumAnnotations);
            });
        </script>
    </body>
</html>
