<script>
    fetch('/data')
    .then(response => response.json())
    .then(data => {
        function createChart(ctx, data, label, annotations) {
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: data.timestamps,
                    datasets: [{
                        label: label,
                        data: data[label.toLowerCase()],
                        borderColor: '#6c757d', // Soft gray line color
                        pointBackgroundColor: '#6c757d', // Neutral gray dot color
                        fill: false,
                        borderWidth: 2,
                        lineTension: 0.1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        x: {
                            ticks: {
                                maxRotation: 90,
                                minRotation: 45,
                            },
                        },
                        y: {
                            beginAtZero: false,
                        },
                    },
                    plugins: {
                        annotation: {
                            annotations: annotations
                        }
                    }
                }
            });
        }

        // Annotations for PM02 (neutral colors)
        const pm02Annotations = [
            {
                type: 'box',
                yMin: 0,
                yMax: 25,
                backgroundColor: 'rgba(173, 216, 230, 0.2)', // Light blue background
                borderColor: '#6c757d', // Gray border
                borderWidth: 1,
                label: {
                    content: 'Good',
                    enabled: true,
                    position: 'center'
                }
            },
            {
                type: 'box',
                yMin: 25,
                yMax: 50,
                backgroundColor: 'rgba(211, 211, 211, 0.2)', // Light gray background
                borderColor: '#6c757d', // Gray border
                borderWidth: 1,
                label: {
                    content: 'Fair',
                    enabled: true,
                    position: 'center'
                }
            },
            {
                type: 'box',
                yMin: 50,
                yMax: 100,
                backgroundColor: 'rgba(169, 169, 169, 0.2)', // Dark gray background
                borderColor: '#6c757d', // Gray border
                borderWidth: 1,
                label: {
                    content: 'Poor',
                    enabled: true,
                    position: 'center'
                }
            },
            {
                type: 'box',
                yMin: 100,
                yMax: Math.max(...data.pm02, 140),
                backgroundColor: 'rgba(169, 169, 169, 0.2)', // Dark gray background
                borderColor: '#6c757d', // Gray border
                borderWidth: 1,
                label: {
                    content: 'Bad',
                    enabled: true,
                    position: 'center'
                }
            }
        ];

        // Annotations for RCO2 (neutral colors)
        const rco2Annotations = [
            {
                type: 'box',
                yMin: Math.min(...data.rco2, 400),
                yMax: 1000,
                backgroundColor: 'rgba(173, 216, 230, 0.2)', // Light blue background
                borderColor: '#6c757d', // Gray border
                borderWidth: 1,
                label: {
                    content: 'Good',
                    enabled: true,
                    position: 'center'
                }
            },
            {
                type: 'box',
                yMin: 1000,
                yMax: 2000,
                backgroundColor: 'rgba(211, 211, 211, 0.2)', // Light gray background
                borderColor: '#6c757d', // Gray border
                borderWidth: 1,
                label: {
                    content: 'Suboptimal',
                    enabled: true,
                    position: 'center'
                }
            },
            {
                type: 'box',
                yMin: 2000,
                yMax: Math.max(...data.rco2, 2200),
                backgroundColor: 'rgba(169, 169, 169, 0.2)', // Dark gray background
                borderColor: '#6c757d', // Gray border
                borderWidth: 1,
                label: {
                    content: 'Bad',
                    enabled: true,
                    position: 'center'
                }
            }
        ];

        // Annotations for RHUM (neutral colors)
        const rhumAnnotations = [
            {
                type: 'box',
                yMin: 30,
                yMax: 60,
                backgroundColor: 'rgba(173, 216, 230, 0.2)', // Light blue background
                borderColor: '#6c757d', // Gray border
                borderWidth: 1,
                label: {
                    content: 'Good',
                    enabled: true,
                    position: 'center'
                }
            }
        ];

        // Create charts
        createChart(document.getElementById('pm02Chart').getContext('2d'), data, 'PM02', pm02Annotations);
        createChart(document.getElementById('rco2Chart').getContext('2d'), data, 'RCO2', rco2Annotations);
        createChart(document.getElementById('atmpChart').getContext('2d'), data, 'ATMP', []);
        createChart(document.getElementById('rhumChart').getContext('2d'), data, 'RHUM', rhumAnnotations);
    });
</script>
